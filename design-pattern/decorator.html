<!DOCTYPE html>
<html lang="zh">
<head>

        <title>实际项目运用之Decorator模式（装饰器模式）</title>
        <meta charset="utf-8" />
        <link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="南乡清水 RSS Feed" />
        <link href="/feeds/design-pattern.rss.xml" type="application/rss+xml" rel="alternate" title="南乡清水 Categories RSS Feed" />


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/theme/pygment.css" />
        <link rel="shortcut icon" href="/theme/images/favicon.ico">

        <script src="/theme/js/libs/modernizr-2.6.2.min.js"></script>




</head>

<body id="index" class="home">

    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="/">南乡清水 <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>

                <ul class="columns">
                    <li><a href="/">首页</a></li>

                    <li
><a href="/yue-du-shu-dan.html">阅读书单</a></li>
                    <li
><a href="/zai-xian-gong-ju.html">在线工具</a></li>
                    <li
><a href="/kai-yuan-xiang-mu.html">开源项目</a></li>
                    <li
><a href="/guan-yu-wo.html">关于我</a></li>
                     <li><a href="/archives.html"><i class="active"></i>归档日志</a></li>
                    <form class="navbar-search pull-right" action="/search.html">
                        <input type="text" class="search-query" placeholder="站内搜" name="q" id="s">
                    </form>
                </ul>
            </div>


<section id="content" class="body">

   <div class="row">

<div id="toc" class="threes columns" style="font-size: 65%">
    <br>
    <h4 style="font-size: 1rem">文章目录</h4>
</div>        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
                <a href="/design-pattern/decorator.html" rel="bookmark"
                   title="Permalink to 实际项目运用之Decorator模式（装饰器模式）">实际项目运用之Decorator模式（装饰器模式）</a></h2>
           
            </header>
            <footer class="post-info">
              <abbr class="published" title="2018-03-28T11:22:00+08:00">
                周三 28 三月 2018
              </abbr>
              <address class="vcard author">By 
                <a class="url fn" href="/author/nicky_chin.html"> nicky_chin</a>
              </address>
            </footer><!-- /.post-info -->
            <div id="contents" class="entry-content">
              <h2>1 概述</h2>
<p>在项目中，经常因一些新增需求，导致同一业务的变更，如果所在类继承关系如下：Parent、Child、Grandparent，那么要在Child类上增强些功能怎么办？给Child类增加方法？那会对Grandparent产生什么影响？该如何去处理？看完本文，你会找到你的答案。</p>
<p>JavaIO中，像下面的嵌套语句很常见，为什么要怎样定义呢？理解装饰模式后，你会找到答案。</p>
<div class="highlight"><pre><span></span>FilterInputStream filterInputStreasm = new BufferedInputStream(new FileInputStream(new File(&quot;/user/a&quot;)));
</pre></div>


<h3>1.1案例</h3>
<p>例如下面一个功能需求，4s店的汽车销售向客户推销自家品牌的产品，我们用代码实现，关系如下：</p>
<p><img alt="类图" src="https://upload-images.jianshu.io/upload_images/10175660-789e0242028d08b0.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>具体代码：
汽车销售类</p>
<div class="highlight"><pre><span></span>public abstract class CarSale {

    /**
     * 推销车的详情
     */
    public abstract void displayCarInfo();

    /**
     * 客户签订购买合同
     */
    public abstract void signContract(String customerName);

}
</pre></div>


<p>汽车参数详情
   ```
public class CarInfo extends CarSale {</p>
<div class="highlight"><pre><span></span>@Override
public void displayCarInfo() {
    System.out.println(&quot;日本丰田GTR&quot;);
    System.out.println(&quot;百公里加速1秒&quot;);
    System.out.println(&quot;油耗偏高&quot;);
    System.out.println(&quot;后驱涡轮增压&quot;);
    System.out.println(&quot;内饰豪华&quot;);
    System.out.println(&quot;发动机噪音偏大&quot;);
    System.out.println(&quot;不支持电动座椅，后视镜加热&quot;);
}

@Override
public void signContract(String customerName) {
    System.out.println(&quot;客户签约销售合同， 付款人：&quot; + customerName);
}
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>客户
</pre></div>


<p>public class Customer {</p>
<div class="highlight"><pre><span></span>public static void main(String[] args) {
    CarInfo carInfo = new CarInfo();
    //介绍车性能
    carInfo.displayCarInfo();
    //油耗太高？？噪音大 推销我买？？ 不存在的
   // carInfo.signContract();
}
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>如果销售并没有很有针对性的去讲解，突出推销车型的优点，买家是不太会买账的，所以作为一个salesman我们需要修改一下我们的营销技巧，比如： 突出速度上的优势，突出后驱车这个特点，
修改后的图示关系如下：
![类关系图](https://upload-images.jianshu.io/upload_images/10175660-d30991660bd22700.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



客户营销类
</pre></div>


<p>public class SalesTalk extends CarInfo {</p>
<div class="highlight"><pre><span></span>private void showSpeedRank() {
    System.out.println(&quot;这个车百公里加速快，外观吊炸天，装逼神器啊，大兄弟&quot;);
}

private void showWheelSys() {
    System.out.println(&quot;后驱车，让你漂移分分钟，就问对方怕不怕&quot;);
}

/**
 * 使用销售技巧，提高签约成功率
 */
@Override
public void displayCarInfo() {
    showSpeedRank();
    super.displayCarInfo();
    showWheelSys();
}
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>客户2
</pre></div>


<p>public class Customer2 {</p>
<div class="highlight"><pre><span></span>public static void main(String[] args) {
    SalesTalk salesTalk = new SalesTalk();
    //销售一顿吹
    salesTalk.displayCarInfo();
    System.out.println(&quot;。。。。。&quot;);
    //艹,买买买
    salesTalk.signContract(&quot;不差钱哥&quot;);
}
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>客户看到销售人员的激情推销，感觉有些心动，毕竟日本神车，最后还是忍不住宣传的力度，签订了销售合同。但是如果这时候，客户还是不买账，我们该怎么办，继续通过突出其他优势来营销么，这样会产生多少个子类，这样会导致类爆炸，类的数量激增，想想以后维护怎么办？并且在面向对象的设计中，如果超过两层继承，你就应该想想是不是出设计问题了，继承层次越多以后的维护成本越多，问题这么多，那怎么办？我们定义一批专门负责装饰的类，然后根据实际情况来决定是否需要进行装饰，类图稍做修正，如图所示
![装饰修饰](https://upload-images.jianshu.io/upload_images/10175660-884183df2ae82b53.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

增加一个抽象类和两个实现类，其中Decorator的作用是封装CarSale类

抽象类
</pre></div>


<p>public abstract class Decorator extends CarSale {</p>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * 销售技巧选择</span>
<span class="cm"> */</span><span class="w"></span>
private<span class="w"> </span>CarSale<span class="w"> </span>carSale<span class="err">;</span><span class="w"></span>

public<span class="w"> </span>Decorator<span class="o">(</span>CarSale<span class="w"> </span>carSale<span class="o">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span>this<span class="o">.</span>carSale<span class="w"> </span><span class="o">=</span><span class="w"> </span>carSale<span class="err">;</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>

<span class="err">@</span>Override<span class="w"></span>
public<span class="w"> </span>void<span class="w"> </span>displayCarInfo<span class="o">()</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span>this<span class="o">.</span>carSale<span class="o">.</span>displayCarInfo<span class="o">()</span><span class="err">;</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>

<span class="err">@</span>Override<span class="w"></span>
public<span class="w"> </span>void<span class="w"> </span>signContract<span class="o">(</span>String<span class="w"> </span>customerName<span class="o">)</span><span class="w"> </span><span class="err">{</span><span class="w"></span>
<span class="w">    </span>this<span class="o">.</span>carSale<span class="o">.</span>signContract<span class="o">(</span>customerName<span class="o">)</span><span class="err">;</span><span class="w"></span>
<span class="err">}</span><span class="w"></span>
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>在构造器中定义需要装饰的类，然后调用displayCarInfo()进行修饰，有点类似代理模式

速度排名
</pre></div>


<p>public class SpeedRankDecorator extends Decorator {</p>
<div class="highlight"><pre><span></span>public SpeedRankDecorator(CarSale carSale) {
    super(carSale);
}

//突出速度特点
private void showSpeedRank() {
    System.out.println(&quot;这个车百公里加速快，外观吊炸天，装逼神器啊，大兄弟&quot;);
}

//宣传
@Override
public void displayCarInfo() {
    showSpeedRank();
    super.displayCarInfo();
}
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>驱动情况
</pre></div>


<p>public class WheelDeployDecorator extends Decorator {</p>
<div class="highlight"><pre><span></span>public WheelDeployDecorator(CarSale carSale) {
    super(carSale);
}

//突出后驱车的优势De
private void showWheelSys() {
    System.out.println(&quot;后驱车，让你漂移分分钟，就问对方怕不怕&quot;);
}

@Override
public void displayCarInfo() {
    showWheelSys();
    super.displayCarInfo();
}
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>客户3
</pre></div>


<p>public class Customer3 {</p>
<div class="highlight"><pre><span></span>public static void main(String[] args) {
    //需要被装饰的类
    CarInfo carInfo = new CarInfo();
    System.out.println(&quot;-----------速度排名--------------&quot;);
    Decorator decorator = new SpeedRankDecorator(carInfo);
    decorator.displayCarInfo();

    System.out.println(&quot;---------汽车驱动-----------&quot;);
    decorator = new WheelDeployDecorator(carInfo);
    decorator.displayCarInfo();
    //听的很舒服那就买
    decorator.signContract(&quot;土豪&quot;);

}
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>如上所示，通过装饰器，我们可以很轻松的包装我们想要的对象

##2 装饰模式（Decorator Pattern）
###概念
&gt;装饰器模式 允许向一个现有的对象添加新的功能，同时又不改变其结构。装饰者可以在所委托被装饰者的行为之前或之后加上自己的行为，以达到特定的目的。

###2.1 组成
![模式类图](https://upload-images.jianshu.io/upload_images/10175660-3292fa99600cd495.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

装饰器模式由组件和装饰者组成。

抽象组件（Component）：需要装饰的抽象对象。 
具体组件（ConcreteComponent）：是我们需要装饰的对象 
抽象装饰类（Decorator）：内含指向抽象组件的引用及装饰者共有的方法。 
具体装饰类（ConcreteDecorator）：被装饰的对象。

###2.2 装饰模式的简化
如果只有一个ConcreteComponent类，那么可以考虑去掉抽象的Component类（接口），把Decorator作为一个ConcreteComponent子类。如下图所示：
![装饰模式](https://upload-images.jianshu.io/upload_images/10175660-d8d99c42e2c36eb7.gif?imageMogr2/auto-orient/strip)

如果只有一个ConcreteDecorator类，那么就没有必要建立一个单独的Decorator类，而可以把Decorator和ConcreteDecorator的责任合并成一个类。

透明性的要求
装饰模式对客户端的透明性要求程序不要声明一个ConcreteComponent类型的变量，而应当声明一个Component类型的变量。

用上面汽车推销的例子来说有：
</pre></div>


<div class="highlight"><pre><span></span>    CarInfo carInfo = new CarInfo();
    System.out.println(&quot;-----------速度排名--------------&quot;);
    Decorator decorator = new SpeedRankDecorator(carInfo);
    decorator.displayCarInfo();

    System.out.println(&quot;---------汽车驱动-----------&quot;);
    decorator = new WheelDeployDecorator(carInfo);
    decorator.displayCarInfo();
    //听的很舒服那就买
    decorator.signContract(&quot;土豪&quot;);
</pre></div>


<div class="highlight"><pre><span></span>  而不是下面的做法：
</pre></div>


<p>WheelDeployDecorator decorator = new WheelDeployDecorator(carInfo);</p>
<div class="highlight"><pre><span></span>###2.3 装饰者模式的优缺点
优点
   可以动态的扩展功能；
   装饰者和被装饰者解耦，互相不关联。

缺点：
   多层装饰比较复杂。

装饰者模式的适用场景：
   扩展一个类的功能；
   动态增加和撤销功能。

注意：装饰者模式可以替代繁杂的继承，但其内部实现使用的也是继承。也就是说，装饰者模式将繁杂的继承转化成了其内部的简单的继承。



##3 装饰模式IO流中的运用
装饰模式在Java语言中的最著名的应用莫过于Java I/O标准库的设计了。

由于Java I/O库需要很多性能的各种组合，如果这些性能都是用继承的方法实现的，那么每一种组合都需要一个类，这样就会造成大量性能重复的类出现。而如果采用装饰模式，那么类的数目就会大大减少，性能的重复也可以减至最少。因此装饰模式是Java I/O库的基本模式。

JavaI/O库的对象结构图如下，由于Java I/O的对象众多，因此只画出InputStream的部分。
![inputstream](https://upload-images.jianshu.io/upload_images/10175660-957c5000047a4ad7.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

根据上图可以看出：

●抽象构件(Component)角色：由InputStream扮演。这是一个抽象类，为各种子类型提供统一的接口。

●具体构件(ConcreteComponent)角色：由ByteArrayInputStream、FileInputStream、PipedInputStream等类扮演。它们实现了抽象构件角色所规定的接口。

●抽象装饰(Decorator)角色：由FilterInputStream扮演。它实现了InputStream所规定的接口。

●具体装饰(ConcreteDecorator)角色：由几个类扮演，有BufferedInputStream、DataInputStream、HttpInputStream等
</pre></div>


<p>public class IOTest {</p>
<div class="highlight"><pre><span></span>public static void main(String[] args) {
    //抽象装饰器                              具体装饰器                      被装饰对象
    FilterInputStream filterInputStream = new BufferedInputStream(new ByteArrayInputStream(&quot;input-test&quot;.getBytes()));
    byte[] bs = new byte[0];
    try {
        bs = new byte[filterInputStream.available()];
        filterInputStream.read(bs);
    } catch (IOException e) {
        e.printStackTrace();
    }
    String content = new String(bs);
    System.out.println(content);
}
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>**像其他的OutputStream Read  Writer  就列举了其抽象装饰器分别是 FilterOutputStream FilterReader FilterWriter**

##4 实际项目中的运用
###4.1 需求
在金融项目数据加密是非常常见的，比如前端将加密后的字符串作为参数传给我们，
我们在接口中解密，再比如我们后端返回给前端的结果也是一串加密后的字符串，这是防止爬虫的一种安全手段，那么我们是否需要在每个接口在去进行加密解密？是否有一套机制去控制我想要加密的接口，同学们应该会想到只需在一个请求到达Controller之前能够截获其请求，并且根据其具体情况对 HttpServletRequest 中的参数进行过滤或者修改。然后再放回到该HttpServletRequest 中呢？

流只能读取一次，读取前端传过来的参数具体参数，如果是post请求，那么getInputStream()可以解析到详细的参数

在正式代码之前，我还是先简单介绍下ServletRequest、HttpServletRequest、ServletRequestWrapper以及HttpServletRequestWrapper这几个接口或者类之间的层次关系，并说明“继承HttpServletRequestWrapper类以实现在Filter中修改HttpServletRequest的参数”这种方式的原理是什么

它们之间的层次关系是这样的：
![tomcat-ServletRequest 关系图](https://upload-images.jianshu.io/upload_images/10175660-6fd8c6fff69d8260.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)


如上图所示，在过滤器中：
</pre></div>


<p>//我们会进入这个方法
doFilter(ServletRequest request, ServletResponse response, FilterChain chain)</p>
<p>//通过ServletRequest进来的，之后我们会强制造型如下：
 HttpServletRequest req=(HttpServletRequest) request;
''''''
//最后调用
chain.doFilter(req, res);</p>
<div class="highlight"><pre><span></span>如果需要对前端加密过来的参数进行解密，那么我们需要对HttpServletRequest进行处理，而上面图关系毫无疑问是一个装饰模式：

&gt;ServletRequest    抽象组件
HttpServletRequest    抽象组件的一个子类
ServletRequestWrapper    一个基本的装饰类，这里是非抽象的
HttpServletRequestWrapper    一个扩展装饰类 兼具体的装饰者

###4.2 具体实现方案
既然是修改getInputStream()方法的内容，我们可以在HttpServletRequestWrapper 做具体的装饰器

下面具体的代码：
</pre></div>


<p>public class ParamsWrapperDecorator extends HttpServletRequestWrapper {</p>
<div class="highlight"><pre><span></span><span class="nt">private</span> <span class="nt">static</span> <span class="nt">final</span> <span class="nt">Logger</span> <span class="nt">logger</span> <span class="o">=</span> <span class="nt">LoggerFactory</span><span class="p">.</span><span class="nc">getLogger</span><span class="o">(</span><span class="nt">ParamsWrapperDecorator</span><span class="p">.</span><span class="nc">class</span><span class="o">);</span>

<span class="nt">private</span> <span class="nt">HttpServletRequest</span> <span class="nt">request</span><span class="o">;</span>

<span class="nt">public</span> <span class="nt">ParamsWrapperDecorator</span><span class="o">(</span><span class="nt">HttpServletRequest</span> <span class="nt">request</span><span class="o">)</span> <span class="p">{</span>
    <span class="err">super(request)</span><span class="p">;</span>
    <span class="err">this.request</span> <span class="err">=</span> <span class="err">request</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">@</span><span class="k">Override</span>
<span class="nt">public</span> <span class="nt">ServletInputStream</span> <span class="nt">getInputStream</span><span class="o">()</span> <span class="nt">throws</span> <span class="nt">IOException</span><span class="o">,</span> <span class="nt">RoborderException</span> <span class="p">{</span>
    <span class="nt">String</span> <span class="nt">path</span> <span class="o">=</span> <span class="nt">request</span><span class="p">.</span><span class="nc">getRequestURI</span><span class="o">();</span>
    <span class="o">//</span><span class="nt">if</span> <span class="o">(</span><span class="nt">new</span> <span class="nt">Random</span><span class="o">()</span><span class="p">.</span><span class="nc">ints</span><span class="o">(</span><span class="nt">0</span><span class="o">,</span> <span class="nt">4</span><span class="o">)</span><span class="p">.</span><span class="nc">boxed</span><span class="o">()</span><span class="p">.</span><span class="nc">findFirst</span><span class="o">()</span><span class="p">.</span><span class="nc">orElse</span><span class="o">(</span><span class="nt">-1</span><span class="o">)</span> <span class="o">==</span> <span class="nt">1</span><span class="o">)</span> <span class="p">{</span>
        <span class="err">LoggerUtil.showInfoLogDetails(logger,</span> <span class="err">&quot;</span><span class="n">IP</span><span class="p">:</span><span class="err">{</span><span class="p">}</span><span class="o">,</span> <span class="err">请求地址</span><span class="o">:</span><span class="p">{}</span><span class="s2">&quot;,Optional.ofNullable(MDC.get(&quot;</span><span class="nt">ip</span><span class="s2">&quot;)).orElse(&quot;</span><span class="nt">unknown</span><span class="s2">&quot;),path);</span>
<span class="s2">   // }</span>
<span class="s2">    final MethodRule  rule = MethodRule.getEnum(path);</span>
<span class="s2">    //处理传入传入参数是否加密</span>
<span class="s2">    ServletInputStream is = handleWithParamsDecrypt(rule);</span>
<span class="s2">    return is == null ? request.getInputStream() : is;</span>

<span class="s2">}</span>

<span class="s2">private ServletInputStream handleWithParamsDecrypt(final MethodRule rule) throws IOException, RoborderException {</span>
<span class="s2">    if (Optional.ofNullable(rule).isPresent() &amp;&amp; rule.getParamsDecrypt()) {</span>
<span class="s2">       // 大致业务逻辑代码</span>
<span class="s2">        BufferedReader reader = request.getReader();</span>
<span class="s2">        String encryptData = String.join(&quot;&quot;, reader.lines().collect(Collectors.toList()));</span>
<span class="s2">        reader.close();</span>
<span class="s2">       .......................................</span>
<span class="s2">        String result;</span>
<span class="s2">        EncapDataDTO dto = JSONObject.parseObject(encryptData, EncapDataDTO.class);</span>
<span class="s2">        try {</span>
<span class="s2">            result = Optional.of(Des3Util.decode(dto.getEncryptData(), secretKey)).orElse(&quot;&quot;);</span>
<span class="s2">            LoggerUtil.showInfoLogDetails(logger, &quot;</span><span class="err">真实传入参数</span><span class="o">:</span><span class="p">{}</span><span class="o">,</span> <span class="err">传入参数</span><span class="nt">encaptData</span><span class="o">:</span><span class="p">{}</span><span class="o">,</span> <span class="err">密钥</span><span class="nt">secretKey</span><span class="o">:</span><span class="p">{}</span><span class="s2">&quot;, result, encryptData, secretKey);</span>
<span class="s2">        } catch (Exception e) {</span>
<span class="s2">            LoggerUtil.showErrorDetails(logger, &quot;</span><span class="err">参数解密失败</span><span class="o">,</span><span class="err">加密的数据为</span><span class="o">:</span><span class="p">{}</span><span class="s2">&quot;, dto.getEncryptData());</span>
<span class="s2">            throw new RoborderException(MemberErrorCode.DATA_TRANSFORM_ERROR);</span>
<span class="s2">        }</span>
<span class="s2">        ByteArrayInputStream is = new ByteArrayInputStream(result.getBytes(Charset.forName(&quot;</span><span class="nt">utf8</span><span class="err">&quot;</span><span class="o">)));</span>

        <span class="nt">return</span> <span class="nt">new</span> <span class="nt">ServletInputStream</span><span class="o">()</span> <span class="p">{</span>

            <span class="err">@Override</span>
            <span class="err">public</span> <span class="err">boolean</span> <span class="err">isFinished()</span> <span class="err">{</span>
                <span class="err">return</span> <span class="err">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="p">@</span><span class="k">Override</span>
            <span class="nt">public</span> <span class="nt">boolean</span> <span class="nt">isReady</span><span class="o">()</span> <span class="p">{</span>
                <span class="nt">return</span> <span class="nt">false</span><span class="o">;</span>
            <span class="p">}</span>
            <span class="p">@</span><span class="k">Override</span>
            <span class="nt">public</span> <span class="nt">void</span> <span class="nt">setReadListener</span><span class="o">(</span><span class="nt">ReadListener</span> <span class="nt">listener</span><span class="o">)</span> <span class="p">{</span>
            <span class="p">}</span>
            <span class="p">@</span><span class="k">Override</span>
            <span class="nt">public</span> <span class="nt">int</span> <span class="nt">read</span><span class="o">()</span> <span class="nt">throws</span> <span class="nt">IOException</span> <span class="p">{</span>
                <span class="nt">return</span> <span class="nt">is</span><span class="p">.</span><span class="nc">read</span><span class="o">();</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="o">;</span>
    <span class="err">}</span>
    <span class="nt">return</span> <span class="nt">null</span><span class="o">;</span>
<span class="err">}</span>
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>定义接口规则枚举类
</pre></div>


<p>public enum MethodRule {</p>
<div class="highlight"><pre><span></span>start(&quot;start&quot;, true, true, EncryptType.BASE64, 0),
Member_registerUser(RequestUrl.Member + RequestUrl.Member_registerUser, false, false, EncryptType.NULL, 0),
end(&quot;end&quot;, true, true, EncryptType.RSA, 0);

private final String url;

/**
 * 参数是否需要解密
 */
private final Boolean paramsDecrypt;

/**
 * 返回结果是否需要加密
 */
private final Boolean resultEncrypt;

/**
 * 加密方式
 */
private final EncryptType signType;

/**
 * 返回数据是否需要压缩 0 不压缩， 1 压缩
 */
private final Integer dataCompress;


MethodRule(String url, Boolean paramsDecrypt, Boolean resultEncrypt, EncryptType signType, Integer dataCompress) {
    this.url = url;
    this.paramsDecrypt = paramsDecrypt;
    this.resultEncrypt = resultEncrypt;
    this.signType = signType;
    this.dataCompress = dataCompress;
}

public static MethodRule getEnum(final String url) {
    return Arrays.stream(MethodRule.values()).filter(method -&gt; url.startsWith(method.URL()))
            .findFirst().orElse(null);
}

public String URL() {
    return url;
}

public Boolean getParamsDecrypt() {
    return paramsDecrypt;
}

public Boolean getResultEncrypt() {
    return resultEncrypt;
}

public EncryptType getSignType() {
    return signType;
}

public Integer getDataCompress() {
    return dataCompress;
}
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>controller层
</pre></div>


<div class="highlight"><pre><span></span>@ApiOperation(value = &quot;用户注册&quot;, notes = &quot;userDTO 可选参数：推荐人userToken  推荐码referralCode，其他为必选参数 &quot;, response = ResultVO.class)
@RequestMapping(value = RequestUrl.Member_registerUser, method = RequestMethod.POST)
public ResultObject&lt;ResultVO&gt; registerUser(){
</pre></div>


<p>}</p>
<div class="highlight"><pre><span></span>最后是dofliter中调用
</pre></div>


<p>HttpServletRequestWrapper params = new ParamsWrapperDecorator(req);
 ResultWrapperDecorator result = new ResultWrapperDecorator(res);
 chain.doFilter(params, result);
```
这里参数加密解密的介绍，后台返回数据加密 也是一个道理，使用装饰器模式可以很好的解决这个问题</p>
            </div><!-- /.entry-content -->
            <div class="comments">
              <h3>Comments</h3>
              <div id="disqus_thread"></div>
              <script type="text/javascript">
                var disqus_identifier = "design-pattern/decorator.html";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'https://nicky-chen.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
              </script>
            </div>


        </div><!-- /.eleven.columns -->

<div class="three columns" style="font-size: 80%">


    <nav class="widget">
        <h4>个人链接</h4>
        <ul class="blank">
            <li><a href="https://stackoverflow.com/users/7444060/nicky-chen">StackOverFlow</a></li>
            <li><a href="https://github.com/nicky-chen">个人GitHub</a></li>
            <li><a href="https://www.jianshu.com/u/c44ed4847c3d">简书博客</a></li>
        </ul>
    </nav>

<h4>专题分类</h4>

 <ul>
     <!---->
     <!---->
     <!---->
     <!--<li><a href="/yue-du-shu-dan.html">阅读书单</a></li>-->
     <!---->
     <!--<li><a href="/zai-xian-gong-ju.html">在线工具</a></li>-->
     <!---->
     <!--<li><a href="/kai-yuan-xiang-mu.html">开源项目</a></li>-->
     <!---->
     <!--<li><a href="/guan-yu-wo.html">关于我</a></li>-->
     <!---->
     <!--<li class="divider-vertical"></li>-->
     <!---->

     <li >
         <a href="/algorithm/index.html">
             Algorithm
         </a>
     </li>
     <li >
         <a href="/classloader/index.html">
             classloader
         </a>
     </li>
     <li >
         <a href="/concurrent/index.html">
             concurrent
         </a>
     </li>
     <li class="active" >
         <a href="/design-pattern/index.html">
             design-pattern
         </a>
     </li>
     <li >
         <a href="/distrubuted/index.html">
             distrubuted
         </a>
     </li>
     <li >
         <a href="/java-base/index.html">
             java-base
         </a>
     </li>
     <li >
         <a href="/mysql/index.html">
             MySql
         </a>
     </li>
  </ul>

<!---->
<!--<h4>Categories</h4>-->
<!--<ul class="blank">-->
	<!---->
		<!--<li><a href="/algorithm/index.html">Algorithm</a></li>-->
	<!---->
		<!--<li><a href="/classloader/index.html">classloader</a></li>-->
	<!---->
		<!--<li><a href="/concurrent/index.html">concurrent</a></li>-->
	<!---->
		<!--<li><a href="/design-pattern/index.html">design-pattern</a></li>-->
	<!---->
		<!--<li><a href="/distrubuted/index.html">distrubuted</a></li>-->
	<!---->
		<!--<li><a href="/java-base/index.html">java-base</a></li>-->
	<!---->
		<!--<li><a href="/mysql/index.html">MySql</a></li>-->
	<!---->
<!--</ul>-->
<!---->


<h4>标签</h4>
	<ul class="blank">
	    <li class="danger label" ><a href="/tag/li-lun.html">理论</a></li>
	    <li class="danger label" ><a href="/tag/chuang-jian-xing.html">创建型</a></li>
	    <li class="danger label" ><a href="/tag/ku-ji-you-hua.html">库级优化</a></li>
	    <li class="danger label" ><a href="/tag/shu-ju-jie-gou.html">数据结构</a></li>
	    <li class="danger label" ><a href="/tag/fen-bu-shi-idfang-an.html">分布式ID方案</a></li>
	    <li class="danger label" ><a href="/tag/yuan-ma.html">源码</a></li>
	    <li class="danger label" ><a href="/tag/si-wei-dao-tu.html">思维导图</a></li>
	    <li class="danger label" ><a href="/tag/xing-wei-xing.html">行为型</a></li>
	    <li class="danger label" ><a href="/tag/ji-chu.html">基础</a></li>
	    <li class="danger label" ><a href="/tag/suo-you-hua.html">锁优化</a></li>
	    <li class="danger label" ><a href="/tag/jie-gou-xing.html">结构型</a></li>
</ul>



<!---->
<!--<nav class="widget">-->
  <!--<h4>Social</h4>-->
  <!--<ul class="blank">-->
  <!---->
    <!--<li><a href="http://jm.taobao.org/">阿里中间件团队博客</a></li>-->
  <!---->
    <!--<li><a href="http://www.spring4all.com/">Spring中文社区</a></li>-->
  <!---->
    <!--<li><a href="https://github.com/alibaba">alibaba开源项目</a></li>-->
  <!---->
    <!--<li><a href="https://github.com/google">google开源项目</a></li>-->
  <!---->
  <!--</ul>-->
<!--</nav>-->
<!---->


</div> </div><!-- /.row -->
  <div class="pagination">★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆★✪☆
      <ul>
        <li class="prev"><a href="/distrubuted/interface-idempotency.html">Next →</a></li>
        <li><a href="/archives.html">博客导航</a></li>
        <li class="next"><a href="/concurrent/thread-jmm-happens-before.html">← Previous</a></li>
      </ul>
    </div>

    <h4>相关文章推荐</h4>
    <ul>
        <li><a href="/design-pattern/adapter.html">实际项目运用之Adapter模式（适配器模式）</a></li>
    </ul>


</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">



                   <address id="about" class="vcard body">
                       <br>
                       <nav class="widget">
                           <h4>推荐博客</h4>
                           <ul class="blank">
                               <li><a href="http://jm.taobao.org/">阿里中间件团队博客</a></li>
                               <li><a href="http://www.spring4all.com/">Spring中文社区</a></li>
                               <li><a href="https://github.com/alibaba">alibaba开源项目</a></li>
                               <li><a href="https://github.com/google">google开源项目</a></li>
                           </ul>
                       </nav>
                       <br/>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
	var pageTracker = _gat._getTracker("UA-119892182-1");
pageTracker._trackPageview();
} catch(err) {}</script>
<script type="text/javascript">
    var disqus_shortname = 'nicky-chen';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
  <script src="/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/theme/js/libs/gumby.min.js"></script>
  <script src="/theme/js/plugins.js"></script>
  <script src="/theme/js/toc.js" type="text/javascript"></script>
    <script>
        (function () {
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            }
            else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>
</body>
</html>